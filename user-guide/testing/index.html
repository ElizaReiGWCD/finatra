<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Testing - Finatra</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:800">
    <link rel="stylesheet" type="text/css" href="/finatra/javascripts/highlight/styles/idea.css">
    <script src="/finatra/javascripts/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }

      .nav {
        font-size: 16px;
      }

      section.page {
        padding: 0px;
      }

      .parent-element {
        -webkit-transform-style: preserve-3d;
        -moz-transform-style: preserve-3d;
        transform-style: preserve-3d;
      }

      .element {
        position: relative;
        top: 50%;
        transform: translateY(-15%);
      }

      h1.brand {
        font-family: &#8216;Open Sans&#8217;, sans-serif;
        font-weight: 800;
        font-size: 84px !important;
      }
    </style>
    <link rel="shortcut icon" href="/finatra/favicon.ico?v=2" type="image/x-icon">
    <link rel="icon" href="/finatra/favicon.ico?v=2" type="image/x-icon">
  </head>

  <body>
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand element" href="/finatra"><img src="/finatra/images/finatra_transparent.gif" style="height:36px; width:36px"/></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li ><a href="/finatra/blog/archives">Blog</a></li>
            <li ><a href="/finatra/assets/FinatraSFScala.pdf">#SFScala Presentation</a></li>
            <li><a href="https://github.com/twitter/finatra/tree/master/http">Getting Started</a></li>
            <li><a href="/finatra/docs/index.html">Scaladoc</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://groups.google.com/forum/#!forum/finatra-users">Forum</a></li>
            <li><a href="/finatra/v1/docs/index.html">v1.x Documentation</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>

    <div class="container">
      <div id="main">
        <section class="page">

          <div>
<article role="article">
  <ol class="breadcrumb">
  <li><a href="/finatra/user-guide">User Guide</a></li>
  <li class="active">Testing</li>
</ol>


<p>Ease of testing is a core philosophy of the Finatra framework and Finatra provides a powerful testing framework allowing for very robust tests of different types.</p>

<h2>Basics</h2>

<p>Finatra provides the following testing features:</p>

<ul>
<li>the ability to start a locally running service and easily issue requests against it and assertion behavior on the responses.</li>
<li>the ability to easily replace or override class implementations throughout the object graph.</li>
<li>the ability to retrieve classes in the object graph to perform assertions on them.</li>
<li>the ability to write tests and deploy test instances without deploying test code to production.</li>
</ul>


<h2><a name="testing-types" href="#testing-types">Types of Tests</a></h2>

<p>What are we talking about when we talk about <em>testing</em>? At a high-level the philosophy of testing in Finatra revolves around the following testing definitions:</p>

<ul>
<li>Feature Tests, the most powerful test enabled by Finatra, allow you to verify all feature requirements of the service by exercising the external interface. Finatra supports both “blackbox testing” and “whitebox testing” against a locally running version of your server. You can selectively swap out certain classes, insert mocks, and perform assertions on internal state.</li>
<li>Integration Tests, similar to feature tests, but the entire service is not started. Instead, a list of “modules” are loaded, and then method calls and assertions are performed at the class-level.</li>
<li>Unit Tests, these are method-level tests of a single class, and the framework stays out of your way.</li>
<li>System Tests &ndash; we also have a concept of larger system testing at a few levels. After release we run a set of blackbox tests as a client of the system, exercising as much of the code as possible to verify functionality post-release. Additionally, we run continuous data-quality testing every day alerting on inconsistencies.</li>
</ul>


<h2><a name="override-modules" href="#override-modules">Override Modules</a></h2>

<hr />

<p>For basic information on Modules in Finatra, see <a href="/finatra/user-guide/getting-started#modules">Modules</a>.</p>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed nec viverra purus, in tristique sapien. Duis eu molestie dolor. Nunc id lectus ac dolor posuere laoreet a at tortor. Ut elementum mi quam, varius consectetur eros suscipit in. Suspendisse ultricies dapibus ex feugiat consectetur. Aliquam massa sapien, egestas eleifend dui ac, scelerisque rhoncus urna. Quisque et magna orci. Etiam nisi augue, sollicitudin sed maximus a, hendrerit non enim. Sed a elementum sem. Fusce suscipit dignissim tincidunt.</p>

<p>Donec hendrerit lorem at hendrerit posuere. Suspendisse metus lacus, molestie ac lobortis vitae, lacinia eu eros. Morbi sodales dui id erat luctus placerat. Quisque condimentum lacinia dignissim. Donec congue lacus eu viverra imperdiet. Pellentesque id semper elit. Integer vulputate ipsum a ligula fringilla, vel blandit nisl lacinia. Sed a ultricies magna. Sed massa mauris, tincidunt non iaculis et, pulvinar at urna. Vivamus placerat, mauris luctus lobortis malesuada, urna neque semper sem, a accumsan risus leo at tellus. Nulla et lobortis lectus, non vulputate nibh.</p>

<h2><a name="test-helpers" href="#test-helpers">Test Helper Classes</a></h2>

<p><img src="/finatra/images/FinatraTesting.png" alt="Finatra Test classes" /></p>

<p>The Finatra testing framework uses the <a href="http://www.scalatest.org/">ScalaTest</a> testing framework and to facilitate the types of testing outlined above we have several testing traits to aid in creating simple and powerful tests.</p>

<h3><a href="http://blog.mattwynne.net/2010/10/22/features-user-stories/">Feature Tests</a></h3>

<p>see: <a href="https://github.com/twitter/finatra/blob/master/inject/inject-app/src/test/scala/com/twitter/inject/app/FeatureTest.scala">app/FeatureTest</a> and <a href="https://github.com/twitter/finatra/blob/master/inject/inject-server/src/test/scala/com/twitter/inject/server/FeatureTest.scala">server/FeatureTest</a></p>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed nec viverra purus, in tristique sapien. Duis eu molestie dolor. Nunc id lectus ac dolor posuere laoreet a at tortor. Ut elementum mi quam, varius consectetur eros suscipit in. Suspendisse ultricies dapibus ex feugiat consectetur. Aliquam massa sapien, egestas eleifend dui ac, scelerisque rhoncus urna. Quisque et magna orci. Etiam nisi augue, sollicitudin sed maximus a, hendrerit non enim. Sed a elementum sem. Fusce suscipit dignissim tincidunt.</p>

<h3>Integration Tests</h3>

<p>see: TestInjector</p>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed nec viverra purus, in tristique sapien. Duis eu molestie dolor. Nunc id lectus ac dolor posuere laoreet a at tortor. Ut elementum mi quam, varius consectetur eros suscipit in. Suspendisse ultricies dapibus ex feugiat consectetur. Aliquam massa sapien, egestas eleifend dui ac, scelerisque rhoncus urna. Quisque et magna orci. Etiam nisi augue, sollicitudin sed maximus a, hendrerit non enim. Sed a elementum sem. Fusce suscipit dignissim tincidunt.</p>

<h3>Http Tests</h3>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed nec viverra purus, in tristique sapien. Duis eu molestie dolor. Nunc id lectus ac dolor posuere laoreet a at tortor. Ut elementum mi quam, varius consectetur eros suscipit in. Suspendisse ultricies dapibus ex feugiat consectetur. Aliquam massa sapien, egestas eleifend dui ac, scelerisque rhoncus urna. Quisque et magna orci. Etiam nisi augue, sollicitudin sed maximus a, hendrerit non enim. Sed a elementum sem. Fusce suscipit dignissim tincidunt.</p>

<h3><code>com.twitter.inject.Mockito</code></h3>

<p>Provides <a href="https://etorreborre.github.io/specs2/">Specs2</a> Mockito syntax sugar for <a href="http://www.scalatest.org/">ScalaTest</a>.</p>

<p>This is a drop-in replacement for org.specs2.mock.Mockito. We encourage you to not use <code>org.specs2.mock.Mockito</code> directly. Otherwise, match failures won&rsquo;t be  propagated up as ScalaTest test failures.</p>

<h2>Startup Tests</h2>

<p>We recommend creating a simple test to check that your service can start up and report itself as healthy. This checks the correctness of the Guice dependency graph, catching errors that can otherwise cause the service to fail to start.</p>

<ul>
<li>Startup tests should mimic production as close as possible. As such:

<ul>
<li>avoid using <code>@Bind</code> and &ldquo;override modules&rdquo; in startup tests.</li>
<li>set the Guice <code>stage</code> to <code>PRODUCTION</code> so that all singletons will be eagerly created at startup (integration/feature tests run in <code>State.DEVELOPMENT</code> by default).</li>
<li>prevent Finagle clients from making outbound connections during startup tests by setting <code>com.twitter.server.resolverMap</code> entries to <code>nil!</code>.</li>
</ul>
</li>
</ul>


<p>For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">com.google.inject.Stage</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.finatra.http.test.EmbeddedHttpServer</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.inject.server.FeatureTest</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MyServiceStartupTests</span> <span class="k">extends</span> <span class="nc">FeatureTest</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">server</span> <span class="k">=</span> <span class="nc">EmbeddedHttpServer</span><span class="o">(</span>
</span><span class='line'>    <span class="n">stage</span> <span class="k">=</span> <span class="nc">Stage</span><span class="o">.</span><span class="nc">PRODUCTION</span><span class="o">,</span>
</span><span class='line'>    <span class="n">twitterServer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SampleApiServer</span><span class="o">,</span>
</span><span class='line'>    <span class="n">clientFlags</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span>
</span><span class='line'>      <span class="s">&quot;com.twitter.server.resolverMap&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;some-thrift-service=nil!&quot;</span>
</span><span class='line'>    <span class="o">))</span>
</span><span class='line'>
</span><span class='line'>  <span class="s">&quot;SampleApiServer&quot;</span> <span class="n">should</span> <span class="o">{</span>
</span><span class='line'>    <span class="s">&quot;startup&quot;</span> <span class="n">in</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">server</span><span class="o">.</span><span class="n">assertHealthy</span><span class="o">()</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><nav>
  <ul class="pager">
    <li class="previous"><a href="/finatra/user-guide/logging"><span aria-hidden="true">&larr;</span>&nbsp;Logging</a></li>
    <li></li>
  </ul>
</nav></p>

  
    <footer>
      
      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    
  
</aside>



        </section>
      </div>
    </div>


    <div id="footer">
      <div class="container">
        <div class="row">&nbsp;</div>
        <div class="row">&nbsp;</div>
        <div class="row">
          <div class="col-md-10">
            <p>
              Copyright &copy; 2015 - Twitter -
              <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
            </p></div>
          <div class="col-md-2">
            <p class="text-muted credit text-right"><a href="https://twitter.com/finatra" data-size="large" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @finatra</a>
              <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></p>
          </div>
        </div>
      </div>
    </div>


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-39101739-9', 'twitter.github.io/finatra');
      ga('send', 'pageview');
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  </body>
</html>
